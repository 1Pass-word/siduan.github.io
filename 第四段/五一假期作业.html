<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/layui@2.8.0/dist/css/layui.css">
    <script src="https://unpkg.com/layui@2.8.0/dist/layui.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.js"></script>
     
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.2/echarts.common.js"></script>
</head>
<style>
    #boxone {
        width: 400px;
        /* height: 300px; */
        position: absolute;
        left: 50%;
        top: 35%;
        transform: translate(-50%, -20%);
        background-color: rgba(8, 8, 8, 0.748);
        text-align: center;
        display: none;
    }

    #xiugai {
        width: 400px;
        /* height: 300px; */
        position: absolute;
        left: 50%;
        top: 35%;
        transform: translate(-50%, -20%);
        background-color: rgba(8, 8, 8, 0.748);
        text-align: center;
        display: none;
    }


    body {
        padding: 20px 0;
    }

    .red {
        color: red;
    }

    .purple {
        color: purple;
    }

    #box {
        width: 600px;
        height: 500px;
        margin: 50px auto;
        padding: 30px;
        position: absolute;
        top: 200px;
        left: 400px;
        background-color: #e7e5e5;
        display: none;
    }

    #boxs {
        width: 100px;
        height: 50px;
        margin: 50px auto;
        padding: 30px;
        position: absolute;
        top: 200px;
        left: 895px;
        background-color: #e7e5e5;
        display: none;
    }
</style>

<body>
    <div id="box">
    </div>
    <div id="boxs">
        <button class="layui-btn" id="guanbi">关闭</button>
    </div>
    <button class="layui-btn" id="tianjia">添加学生</button>
    <button onclick="xuanzhong()" class="layui-btn">选中删除</button>
    <input type="text" placeholder="搜索" id="name" class="layui-input" style="width: 200px; float: left;margin:0 30px;">
    <div id="boxone">
        <h2>添加栏</h2>
        <br>
        <input type="text" name="name" placeholder="姓名" id="Name_one" value="张亚哲">
        <br><br>
        <input type="text" name="iphone" placeholder="3.31的机试成绩" id="password" value="65">
        <br><br>
        <input type="text" name="nick" placeholder="4.7的机试成绩" id="birthday" value="30">
        <br><br>
        <input type="text" name="sex" placeholder="4.7的笔试成绩" id="number" value="40">
        <br><br>
        <input type="text" name="sex" placeholder="4.7的平均分" id="types" value="32">
        <br><br>
        <input type="text" name="iphone" placeholder="4.14的机试成绩" id="shisihao" value="50">
        <br><br>
        <input type="text" name="nick" placeholder="4.21的机试成绩" id="shibirthday" value="70">
        <br><br>
        <input type="text" name="sex" placeholder="4.21的笔试成绩" id="shinumber" value="34">
        <br><br>
        <input type="text" name="sex" placeholder="4.21的平均分" id="shitypes" value="45">
        <br><br>
        <input type="text" name="sex" placeholder="教学周期平均分" id="zongtypes" value="58">
        <br><br>
        <button class="layui-btn layui-btn-radius" onclick="submit()">添加</button>
        <button class="layui-btn layui-btn-radius" id="Shut_down">关闭</button>
    </div>
    <div id="xiugai">
        <h2>修改栏</h2>
        <br>
        <input type="text" name="name" placeholder="姓名" id="Name_ones">
        <br><br>
        <input type="text" name="iphone" placeholder="3.31的机试成绩" id="passwords">
        <br><br>
        <input type="text" name="nick" placeholder="4.7的机试成绩" id="birthdays">
        <br><br>
        <input type="text" name="sex" placeholder="4.7的笔试成绩" id="numbers">
        <br><br>
        <input type="text" name="sex" placeholder="4.7的平均分" id="typess">
        <br><br>
        <input type="text" name="iphone" placeholder="4.14的机试成绩" id="shisihaos">
        <br><br>
        <input type="text" name="nick" placeholder="4.21的机试成绩" id="shibirthdays">
        <br><br>
        <input type="text" name="sex" placeholder="4.21的笔试成绩" id="shinumbers">
        <br><br>
        <input type="text" name="sex" placeholder="4.21的平均分" id="shitypess">
        <br><br>
        <input type="text" name="sex" placeholder="教学周期平均分" id="zongtypess">
        <br><br>
        <button class="layui-btn layui-btn-radius" id="queren">确认修改</button>
        <button class="layui-btn layui-btn-radius" id="quxiao">取消修改</button>
    </div>
    <table class="layui-table">
        <thead>
            <tr>
                <th rowspan="2"><input type="checkbox" name="" id="qxs"></th>
                <th rowspan="2">姓名</th>
                <th>3.31(星期五)</th>
                <th colspan="3">4.7(星期五)</th>
                <th>4.14(星期五)</th>
                <th colspan="3">4.21(星期五)</th>
                <th rowspan="2">教学周期平均分</th>
                <th rowspan="2">操作</th>
            </tr>
            <tr>
                <th>机试成绩</th>
                <th>笔试成绩</th>
                <th>机试成绩</th>
                <th>平均分</th>
                <th>机试成绩</th>
                <th>笔试成绩</th>
                <th>机试成绩</th>
                <th>平均分</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <script>
        var data = []
        $(function () {
            if (localStorage.getItem('clab')) {
                data = JSON.parse(localStorage.getItem('clab'))
            }
            show()
            bianse()
        })
        function bianse() {
            $('.ace').each(function () {
                var ace = parseInt($(this).text());
                if (ace < 50) {
                    $(this).addClass('red');
                } else if (ace >= 90) {
                    $(this).addClass('purple');
                }
            });
        }
        // 搜索
        $("#name").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("table tbody tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
        //修改
        let i = 0
        function xiu(i) {
            console.log(i);
            let abb = data[i]
            $(function () {
                $('#Name_ones').val(abb.name),
                    $('#passwords').val(abb.diyici),
                    $('#birthdays').val(abb.dierci),
                    $('#numbers').val(abb.disanci),
                    $('#typess').val(abb.disici),
                    $('#shisihaos').val(abb.diwuci),
                    $('#shibirthdays').val(abb.diliuci),
                    $('#shinumbers').val(abb.diqici),
                    $('#shitypess').val(abb.dibaci),
                    $('#zongtypess').val(abb.dijiuci)
            })
            $('#xiugai').css('display', 'block')
            //确认修改
            $('#queren').click(function () {
                data[i] = {
                    name: $('#Name_ones').val(),
                    diyici: $('#passwords').val(),
                    dierci: $('#birthdays').val(),
                    disanci: $('#numbers').val(),
                    disici: $('#typess').val(),
                    diwuci: $('#shisihaos').val(),
                    diliuci: $('#shibirthdays').val(),
                    diqici: $('#shinumbers').val(),
                    dibaci: $('#shitypess').val(),
                    dijiuci: $('#zongtypess').val(),
                }
                localStorage.setItem('clab', JSON.stringify(data))
                show()
                console.log(abb);
            })
            console.log(abb);
        }
        $('#quxiao').click(function () {
            $('#xiugai').css('display', 'none')
        })

        //选中删除
        function xuanzhong() {
            if (confirm("确定要删除吗")) {
                $("table tbody tr").has("input[type='checkbox']:checked").each(function () {
                    let index = event.target.dataset.index
                    data.splice(index, 1)
                    localStorage.setItem('clab', JSON.stringify(data))
                    show()
                });
                alert('删除成功')
            }
        }
        //全选反选
        $('#qxs').on('click', function () {
            $('.qx').prop('checked', this.checked);
        })
        function qx() {
            let atr = 0
            $(".qx").each(function () {
                if (this.checked == true) {
                    atr++
                }
            })
            let chang = $('tbody tr').length
            if (atr == chang) {
                console.log(1);
                $('#qxs').prop('checked', true)
            } else {
                $('#qxs').prop('checked', false)
            }
        }
        //删除
        function shan() {
            var bool = confirm("确定删除?")
            if (bool) {
                let index = event.target.dataset.index
                data.splice(index, 1)
                localStorage.setItem('clab', JSON.stringify(data))
                show()
                alert('删除成功')
            } else {
                alert('已取消删除')
            }

        }
        //添加
        function submit() {
            let abb = {
                name: $('#Name_one').val(),
                diyici: $('#password').val(),
                dierci: $('#birthday').val(),
                disanci: $('#number').val(),
                disici: $('#types').val(),
                diwuci: $('#shisihao').val(),
                diliuci: $('#shibirthday').val(),
                diqici: $('#shinumber').val(),
                dibaci: $('#shitypes').val(),
                dijiuci: $('#zongtypes').val(),
            }
            data.push(abb)
            console.log(abb);
            $('#boxone').css('display', 'none')
            localStorage.setItem('clab', JSON.stringify(data))
            show()
        }
        //渲染
        function show() {
            let html = ''
            data.forEach((item, index) => {
                html += `
                <tr>
                <td><input type="checkbox" class='qx' onclick='qx()'></td>
                <td>${item.name}</td>
                <td class='ace'>${item.diyici}</td>
                <td class='ace'>${item.dierci}</td>
                <td class='ace'>${item.disanci}</td>
                <td class='ace'>${item.disici}</td>
                <td class='ace'>${item.diwuci}</td>
                <td class='ace'>${item.diliuci}</td>
                <td class='ace'>${item.diqici}</td>
                <td class='ace'>${item.dibaci}</td>
                <td class='ace'>${item.dijiuci}</td>
                <td>
                    <button class="layui-btn"  data-index='${index}'onclick=shan()>删除</button>
                    <button class="layui-btn" onclick='xiu(${index})'>编辑</button>
                    <button class="layui-btn" onclick='kan(${index})'>查看成绩图标</button>
                </td>
            </tr>
        `
            })
            $('tbody').html(html)
        }
        //点击添加弹出添加框
        $('#tianjia').click(function () {
            $('#boxone').css('display', 'block')
        })
        //点击关闭隐藏添加框
        $('#Shut_down').click(function () {
            event.preventDefault()
            $('#boxone').css('display', 'none')
        })
        //查看
        function kan(i) {
            console.log(data[i]);
            $('#box').css('display', 'block')
            $('#boxs').css('display', 'block')
            icon(i)
        }
        $('#guanbi').click(function () {
            $('#box').css('display', 'none')
            $('#boxs').css('display', 'none')
        })
    </script>
    <script>
        function icon(n) {
            var myChart,
                options,
                index = 0;
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById("box"));
            // 指定图表的配置项和数据
            var option = {
                title: {
                    text: `${data[n].name}考试成绩`,
                },
                tooltip: {},
                legend: {
                    data: ["机试", "笔试"],
                },
                xAxis: {
                    data: [3.31, 4.7, 4.14, 4.21],
                },
                yAxis: {},
                series: Score(index),

            };
            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
            function Score(index) {
                return [
                    {
                        label: {
                            show: true,
                            position: "top",
                        },
                        data: chengji(),
                        name: "机试",
                        type: "bar",
                    },
                    {
                        label: {
                            show: true,
                            position: "top",
                        },
                        data: hengji(),
                        name: "笔试",
                        type: "bar",
                    },
                ];
            }
            function chengji() {
                let a = [data[n].diyici, data[n].disanci, data[n].diwuci, data[n].diqici]
                return a
            }
            function hengji() {
                let a = [0, data[n].dierci, 0, data[n].diliuci]
                return a;
            }
        }
    </script>
</body>

</html>